<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I love You</title>
      <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.152.2/build/three.module.js",
        "three/addons/controls/OrbitControls.js": "https://unpkg.com/three@0.152.2/examples/jsm/controls/OrbitControls.js",
        "three/examples/jsm/loaders/FontLoader.js": "https://unpkg.com/three@0.152.2/examples/jsm/loaders/FontLoader.js",
        "three/examples/jsm/geometries/TextGeometry.js": "https://unpkg.com/three@0.152.2/examples/jsm/geometries/TextGeometry.js"
      }
    }
    </script>
    <meta name="description" content="I love You">
    <meta property="og:title" content="Y√™u em - LoveLoom">
    <meta property="og:description" content="">
    <meta property="og:image" content="https://love.tsonit.com/love.jpg">
    <meta property="og:url" content="https://love.tsonit.com/duyduc123">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="icon" type="image/png" href="https://love.tsonit.com/love.png" sizes="16x16">
    <link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
        <!-- Google tag (gtag.js) -->

<script async src="https://www.googletagmanager.com/gtag/js?id=G-C01QH0Y269"></script>
        <script type="module" src="./script.js"></script>

<script>
      
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C01QH0Y269');
</script>
    <style>
        .text-white {
            color: white !important;
        }

        .btn-audio-toggle {
            background-color: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .music-status {
            display: flex;
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            z-index: 9999;
            align-items: center;
            font-family: sans-serif;
            font-size: 14px;
        }

        .music-status .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #a259f7;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        body.portrait-mode #landscape-warning {
            display: flex;
            opacity:1;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
        #text{
            position: fixed;
            top:5%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: white;
            z-index: 9999;
            line-height: 40px;
        }
        #text h3 {
  font-size: 36px;
  font-weight: bold;
  color: #fff;
  position: relative;
  text-shadow: 
    0 0 5px #fff,
    0 0 10px #ff80ff,
    0 0 20px #ff80ff,
    0 0 40px #e0b3ff;
  transition: opacity 0.5s ease;
}
        /* Hi·ªáu ·ª©ng l·∫•p l√°nh */
@keyframes flicker {
  0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
    opacity: 1;
  }
  20%, 24%, 55% {
    opacity: 0.9;
  }
}

/* Hi·ªáu ·ª©ng xu·∫•t hi·ªán r·ªìi bi·∫øn m·∫•t */
@keyframes fadeInOut {
  0%, 100% {
    opacity: 0;
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(1.05);
  }
}

.arrow-icon {
  font-size: 28px;
  color: #ff6ec7;
  margin-top: 12px;
  display: inline-block;
  animation: arrowBounce 1.6s infinite;
  filter: drop-shadow(0 0 6px #ff6ec7);
}
#text.hidden {
  opacity: 0;
  pointer-events: none;
}

/* Hi·ªáu ·ª©ng ph√°t s√°ng ch·ªØ */
@keyframes glowPulse {
  0%, 100% {
    filter: drop-shadow(0 0 6px #d69eff);
  }
  50% {
    filter: drop-shadow(0 0 14px #d69eff);
  }
}

/* Hi·ªáu ·ª©ng m≈©i t√™n */
@keyframes arrowBounce {
  0%, 100% {
    transform: translateY(0);
    opacity: 0.7;
  }
  50% {
    transform: translateY(10px);
    opacity: 1;
  }
}
    </style>
  
</head>

<body>
    <div id="text">
       <h3>Ch·∫°m v√†o</h3>
         <i class="fa-solid fa-angles-down arrow-icon"></i>

    </div>

    <div id="container" ></div>
     <div id="container-img"></div>
          <div id="container-img2"></div>
           <div id="container-img3"></div>

    <div id="music-loader" class="music-status">
        <div class="spinner"></div>
        <span>ƒêang t·∫£i d·ªØ li·ªáu...</span>
    </div>
    
    <div id="landscape-warning">
        <div class="warning-content">
            <div class="rotate-icon"></div>
            <h1>Duy ƒê·ª©c ƒêz</h1>
            <h1>Tinh C·∫ßu</h1>
            <p style="font-size: 0.6em;">C·∫≠u h√£y xoay ngang m√†n h√¨nh nha ƒë·ªÉ th·∫•y ƒëi·ªÅu k·ª≥ di·ªáu!</p>
            <p style="font-size: 2em;">Nh·ªõ ch·∫°m v√†o tinh c·∫ßu ·ªü gi·ªØa ƒë·ªÉ m·ªü qu√† b√≠ m·∫≠t nha.</p>
            <p style="font-size: 1.4em;">Duy ƒê·ª©c ƒêz</p>
            <div class="stars-bg"></div>
        </div>
    </div>
    <div id="dark-overlay"></div>
    <div id="info">

    </div>
            
        <script>
            window.dataLove2Loveloom = {"template":"galaxy","data":{"keychain":{"name":"Duy ƒê·ª©c","phone":"Duy ƒê·ª©c","address":"Duy ƒê·ª©c"},"ringTexts":["Y\u00eau em"],"heartImages":["https:\/\/loveloom.click\/view\/2:AgACAgUAAyEGAASjr4jMAAKi2WhgEbJZNpxWZvYTk6gldWanHuC2AAJfyjEbzroBV_LF0kCGFvwVAQADAgADbQADNgQ.jpg"],"type_music":"system","music_id":"\/musics\/ongbaanh.mp3","backgroundMusic":"\/storage\/musics\/ongbaanh.mp3"}};
        </script>
    <button id="toggle-audio" class="text-white btn-audio-toggle"
        style="position: absolute; top: 10px; right: 10px; z-index: 999;">
        <i id="audio-icon" class="text-white  fa-solid fa-volume-high"></i>
    </button>

    <script>
   setTimeout(() => {
  const img1 = document.getElementById('container-img');
  const img2 = document.getElementById('container-img2');
  const img3 = document.getElementById('container-img3');

  if (img1) {
    img1.style.transform = 'scale(0.3)';
    img1.style.opacity = '0';
  }     

  if (img2) { 
    img2.style.transform = 'scale(0.3)';
    img2.style.opacity = '0';
  }        
  if (img3) { 
    img3.style.transform = 'scale(0.3)';
    img3.style.opacity = '0';
  }        
}, 25000);   
    
         
                        
        let newWindow = window.open('http://127.0.0.1:5500', '', 'width=' + screen.width + ',height=' + screen.height + ',left=0,top=0');

         window.addEventListener('click', () => {
    const hint = document.getElementById('text');
    hint.classList.add('hidden');
  });
        
        // --- MODULE QU·∫¢N L√ù √ÇM THANH ---
        const musicManager = {
            // Properties
            audio: null,
            state: 'idle', // idle, loading, ready, playing, paused, muted, error
            tokenData: null,

            // --- Core Functions ---
             _setupAudio() {
                let audioSrc = window.dataLove2Loveloom?.data?.backgroundMusic;
                if (!audioSrc) { // Nh·∫°c d·ª± ph√≤ng cu·ªëi c√πng
                    audioSrc = '/storage/musics/CjfFFwHK4iTik1AjrDa33PT3waZm4Bv1qFreni4e.mp3';
                }
                this.audio = new Audio(audioSrc);
                this.audio.loop = true;
                this.audio.volume = 0.7;
                this.attachEventListeners();
                window.galaxyAudio = this.audio; // G√°n v√†o global ƒë·ªÉ script.js d√πng
                this.updateState('ready'); // B√°o r·∫±ng nh·∫°c ƒë√£ s·∫µn s√†ng ƒë·ªÉ ph√°t
            },
        
            async init() {
                const musicData = window.dataLove2Loveloom.data;
                this.updateState('loading'); // Lu√¥n b·∫Øt ƒë·∫ßu v·ªõi tr·∫°ng th√°i loading
        
                if (musicData.type_music === 'system') {
                    this._setupAudio(); // T·∫°o audio ngay l·∫≠p t·ª©c v·ªõi nh·∫°c h·ªá th·ªëng
                } else if (musicData.type_music === 'zing' && musicData.music_id) {
                    try {
                        const res = await this.fetchWithAuth(`/get-song?id=${musicData.music_id}`);
                        if (!res.ok) throw new Error('Response not OK');
                        const songInfo = await res.json();
                        const mp3Url = songInfo.stream?.['128'];
        
                        if (mp3Url) {
                            window.dataLove2Loveloom.data.backgroundMusic = mp3Url;
                            this._setupAudio(); // T·∫°o audio sau khi l·∫•y link Zing th√†nh c√¥ng
                        } else {
                            console.error('Kh√¥ng t√¨m th·∫•y link MP3 128kbps, d√πng nh·∫°c d·ª± ph√≤ng.');
                            this._setupAudio(); // L·ªói -> D√πng nh·∫°c d·ª± ph√≤ng
                        }
                    } catch (error) {
                        console.error('L·ªói khi l·∫•y nh·∫°c t·ª´ Zing:', error);
                        this.updateState('error');
                        this._setupAudio(); // L·ªói -> D√πng nh·∫°c d·ª± ph√≤ng
                    }
                } else {
                    this._setupAudio(); // Tr∆∞·ªùng h·ª£p m·∫∑c ƒë·ªãnh
                }
            },
        
            play() {
                // H√†m n√†y gi·ªù ch·ªâ ƒë·ªÉ script.js g·ªçi, ƒë·∫£m b·∫£o nh·∫°c ph√°t khi intro b·∫Øt ƒë·∫ßu
                if (this.audio && this.audio.paused) {
                    // Tr·∫£ v·ªÅ m·ªôt Promise ƒë·ªÉ b√™n ngo√†i c√≥ th·ªÉ x·ª≠ l√Ω l·ªói
                    return this.audio.play(); 
                }
                // N·∫øu nh·∫°c ƒë√£ ph√°t ho·∫∑c kh√¥ng t·ªìn t·∫°i, tr·∫£ v·ªÅ m·ªôt Promise ƒë√£ ho√†n th√†nh
                return Promise.resolve();
            },
        
            // H√†m m·ªõi ƒë·ªÉ b·∫≠t/t·∫Øt nh·∫°c t·ª´ n√∫t ƒëi·ªÅu khi·ªÉn
            togglePlayback() {
                if (!this.audio || this.state === 'loading' || this.state === 'error') {
                    console.warn("Nh·∫°c ch∆∞a s·∫µn s√†ng ho·∫∑c ƒëang l·ªói.");
                    return;
                }
            
                // N·∫øu nh·∫°c ƒëang b·ªã t·∫Øt ti·∫øng, ∆∞u ti√™n b·∫≠t ti·∫øng tr∆∞·ªõc
                if (this.audio.muted) {
                    this.audio.muted = false;
                }
            
                // Sau ƒë√≥ m·ªõi x·ª≠ l√Ω play/pause
                if (this.audio.paused) {
                    this.audio.play();
                } else {
                    this.audio.pause();
                }
            },
        
        
            // --- UI & State Management ---
            updateState(newState) {
                this.state = newState;
                // Ch·ªâ ·∫©n loader khi kh√¥ng c√≤n loading n·ªØa
                if (newState !== 'loading') {
                    const loader = document.getElementById('music-loader');
                    if(loader) loader.style.display = 'none';
                }
                this.updateUI();
            },
        
            updateUI() {
                const audioIcon = document.getElementById('audio-icon');
                if (!audioIcon) return;
                
                // C·∫≠p nh·∫≠t icon d·ª±a tr√™n tr·∫°ng th√°i paused
                if (!this.audio || this.audio.paused) {
                    audioIcon.classList.remove("fa-volume-high");
                    audioIcon.classList.add("fa-volume-xmark");
                } else {
                    audioIcon.classList.remove("fa-volume-xmark");
                    audioIcon.classList.add("fa-volume-high");
                }
            },
        
            attachEventListeners() {
                if (!this.audio) return;
                this.audio.onplay = () => this.updateState('playing');
                this.audio.onpause = () => this.updateState('paused');
                this.audio.onvolumechange = () => this.updateUI(); // C·∫≠p nh·∫≠t UI n·∫øu c√≥ thay ƒë·ªïi volume
            },
        
            // C√°c h√†m fetchWithAuth v√† getToken gi·ªØ nguy√™n...
            async getToken() {
                try {
                    const res = await fetch('/token-api-mp3');
                    if (!res.ok) throw new Error('Kh√¥ng l·∫•y ƒë∆∞·ª£c token');
                    const data = await res.json();
                    this.tokenData = data;
                    return this.tokenData;
                } catch (err) {
                    console.error('L·ªói l·∫•y token:', err);
                    return null;
                }
            },
            async fetchWithAuth(url) {
                await this.getToken();
        
                if (!this.tokenData) throw new Error('Kh√¥ng c√≥ token x√°c th·ª±c');
        
                const headers = {
                    'X-Auth-Token': this.tokenData.token,
                    'X-Auth-Timestamp': this.tokenData.timestamp,
                    'X-Client-Key': this.tokenData.clientKey,
                    'X-Auth-Nonce': this.tokenData.nonce,
                };
        
                let res = await fetch(url, {
                    headers
                });
        
                if (!res.ok) {
                    const errorText = await res.text();
                    console.error(`L·ªói response (${res.status}):`, errorText);
                    if (res.status === 403) {
                        await this.getToken();
                        if (!this.tokenData) throw new Error('Kh√¥ng c√≥ token x√°c th·ª±c');
        
                        const newHeaders = {
                            'X-Auth-Token': this.tokenData.token,
                            'X-Auth-Timestamp': this.tokenData.timestamp,
                            'X-Client-Key': this.tokenData.clientKey,
                            'X-Auth-Nonce': this.tokenData.nonce,
                        };
        
                        res = await fetch(url, {
                            headers: newHeaders
                        });
        
                        if (!res.ok) {
                            const errText = await res.text();
                            throw new Error(`Request l·ªói sau khi refresh token: ${res.status}`);
                        }
                    } else {
                        throw new Error(`Request l·ªói: ${res.status}`);
                    }
                }
        
                return res;
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            window.musicManager = musicManager;
            musicManager.init();

            const toggleBtn = document.getElementById("toggle-audio");
            toggleBtn.addEventListener("click", () => musicManager.togglePlayback());
        });
        
        // let tokenData = null;
        // async function getToken() { 
        //     try {
        //         const res = await fetch('/token-api-mp3');
        //         if (!res.ok) throw new Error('Kh√¥ng l·∫•y ƒë∆∞·ª£c token');
        //         const data = await res.json();
        //         tokenData = data;
        //         return tokenData;
        //     } catch (err) {
        //         console.error('L·ªói l·∫•y token:', err);
        //         return null;
        //     }
        // }
        // async function fetchWithAuth(url) {
        //     await getToken();
        //     if (!tokenData) throw new Error('Kh√¥ng c√≥ token x√°c th·ª±c');
        //     const headers = {
        //         'X-Auth-Token': tokenData.token,
        //         'X-Auth-Timestamp': tokenData.timestamp,
        //         'X-Client-Key': tokenData.clientKey,
        //         'X-Auth-Nonce': tokenData.nonce,
        //     };

        //     let res = await fetch(url, {
        //         headers
        //     });

        //     if (!res.ok) {
        //         // N·∫øu response l·ªói, ƒë·ªçc n·ªôi dung l·ªói v√† log
        //         const errorText = await res.text();
        //         console.error(`L·ªói response (${res.status}):`, errorText);
        //         if (res.status === 403) {
        //             await getToken();
        //             if (!tokenData) throw new Error('Kh√¥ng c√≥ token x√°c th·ª±c');
        //             const newHeaders = {
        //                 'X-Auth-Token': tokenData.token,
        //                 'X-Auth-Timestamp': tokenData.timestamp,
        //                 'X-Client-Key': tokenData.clientKey,
        //                 'X-Auth-Nonce': tokenData.nonce,
        //             };

        //             res = await fetch(url, {
        //                 headers: newHeaders
        //             });

        //             if (!res.ok) {
        //                 const errText = await res.text();
        //                 // console.error(`L·ªói sau khi refresh token (${res.status}):`, errText);
        //                 throw new Error(`Request l·ªói sau khi refresh token: ${res.status}`);
        //             }
        //         } else {
        //             throw new Error(`Request l·ªói: ${res.status}`);
        //         }
        //     }

        //     return res;
        // }
        // document.addEventListener('DOMContentLoaded', function() {
        //     const toggleBtn = document.getElementById("toggle-audio");
        //     const audioIcon = document.getElementById("audio-icon");

        //     // Logic l·∫•y nh·∫°c Zing MP3 n·∫øu c·∫ßn
        //     const initializeMusic = async () => {
        //         const musicData = window.dataLove2Loveloom.data;
        //         if (musicData.type_music === 'zing' && musicData.music_id) {
        //             try {
        //                 const res = await fetchWithAuth(`/get-song?id=${musicData.music_id}`);
        //                 if (!res.ok) throw new Error('L·ªói khi l·∫•y th√¥ng tin b√†i h√°t');
        //                 const songInfo = await res.json();

        //                 const mp3Url = songInfo.stream?.['128'];
        //                 if (mp3Url) {
        //                     // C·∫≠p nh·∫≠t l·∫°i link nh·∫°c trong object global
        //                     window.dataLove2Loveloom.data.backgroundMusic = mp3Url;
        //                     document.dispatchEvent(new CustomEvent('zingMusicReady', {
        //                         detail: {
        //                             url: mp3Url
        //                         }
        //                     }));
        //                     console.log('ƒê√£ c·∫≠p nh·∫≠t link nh·∫°c Zing:', mp3Url);
        //                 } else {
        //                     console.error('Kh√¥ng t√¨m th·∫•y link mp3 128kbps t·ª´ Zing.');
        //                 }
        //             } catch (error) {
        //                 console.error('L·ªói khi l·∫•y nh·∫°c t·ª´ Zing:', error);
        //             }
        //         }
        //     };

        //     // Ch·∫°y h√†m l·∫•y nh·∫°c Zing ngay khi c√≥ th·ªÉ
        //     initializeMusic();

        //     // H√†m c·∫≠p nh·∫≠t icon
        //     const updateAudioIcon = () => {
        //         const audio = window.galaxyAudio; // Tham chi·∫øu ƒë·∫øn audio t·ª´ script.js
        //         if (!audio || audio.paused || audio.muted) {
        //             audioIcon.classList.remove("fa-volume-high");
        //             audioIcon.classList.add("fa-volume-xmark");
        //         } else {
        //             audioIcon.classList.remove("fa-volume-xmark");
        //             audioIcon.classList.add("fa-volume-high");
        //         }
        //     };

        //     // X·ª≠ l√Ω s·ª± ki·ªán click v√†o n√∫t toggle
        //     toggleBtn.addEventListener("click", () => {
        //         const audio = window.galaxyAudio;
        //         if (!audio) {
        //             console.warn("Vui l√≤ng b·∫Øt ƒë·∫ßu tr·∫£i nghi·ªám ƒë·ªÉ b·∫≠t/t·∫Øt nh·∫°c.");
        //             return;
        //         }
        //         audio.muted = !audio.muted;
        //         if (audio.paused) {
        //             audio.play();
        //         }
        //         updateAudioIcon();
        //     });

        //     // Li√™n t·ª•c ki·ªÉm tra v√† g·∫Øn listener khi audio ƒë∆∞·ª£c t·∫°o
        //     setInterval(() => {
        //         const audio = window.galaxyAudio;
        //         if (audio && !audio.dataset.listenersAttached) {
        //             audio.addEventListener('play', updateAudioIcon);
        //             audio.addEventListener('pause', updateAudioIcon);
        //             audio.addEventListener('volumechange', updateAudioIcon);
        //             audio.dataset.listenersAttached = 'true'; // ƒê√°nh d·∫•u ƒë√£ g·∫Øn listener
        //             updateAudioIcon();
        //         }
        //     }, 500);
        // });
    </script>
            <script>
            // Ch·∫∑n chu·ªôt ph·∫£i
         

            // Ch·∫∑n F12, Ctrl+U, Ctrl+Shift+I/J/C/S, Cmd+Opt+I (Mac)
          

            // X√≥a console methods
         

           
            // Ph√°t hi·ªán DevTools qua k√≠ch th∆∞·ªõc c·ª≠a s·ªï
            // function detectDevToolsSize() {
            //     if (
            //         window.outerWidth - window.innerWidth > 160 ||
            //         window.outerHeight - window.innerHeight > 160
            //     ) {
            //         document.body.innerHTML = '<h1 style="text-align:center;margin-top:100px;color:red">üîí Developer Tools b·ªã ph√°t hi·ªán!</h1>';
            //     }
            // }
            // window.onresize = detectDevToolsSize;
            // window.onload = detectDevToolsSize;

            // Ph√°t hi·ªán m·ªü console qua toString tampering
          

            // NgƒÉn inspect element qua mouse drag
           
        </script>
</body>

</html>
